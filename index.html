<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script defer src="https://cloud.umami.is/script.js" data-website-id="4a56b2a6-010f-412d-b1ae-59417d30a68d"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4b6cb7">
    <meta name="description" content="ä¸“ä¸ºæ•™å¸ˆè®¾è®¡çš„å®ç”¨å·¥å…·é›†åˆ">
    <meta name="keywords" content="æ•™å¸ˆå·¥å…·,æ•™å­¦å·¥å…·,è¯¾å ‚ç®¡ç†,éšæœºç‚¹å,è®¡æ—¶å™¨,ç”µå­ç™½æ¿">
    <meta name="author" content="Teacher Toolkit Team">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="æ•™å¸ˆå·¥å…·ç®±">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="manifest" href="config/manifest.json">
    <link rel="icon" href="assets/images/briefcase-192x192.png" type="image/png">
    <link rel="apple-touch-icon" href="assets/images/briefcase-192x192.png">
    <title>æ•™å¸ˆå·¥å…·ç®±</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <script src="src/js/student-manager.js"></script>
    <style>
        /* æèµ æç¤ºå¼¹çª—æ ·å¼ */
        .donation-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .donation-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .donation-modal {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 420px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: scale(0.8) translateY(20px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .donation-modal-overlay.show .donation-modal {
            transform: scale(1) translateY(0);
        }
        
        .donation-modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #FF6B6B 0%, #FFE66D 50%, #4ECDC4 100%);
        }
        
        .donation-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .donation-modal-close:hover {
            background: rgba(0, 0, 0, 0.2);
            transform: rotate(90deg);
        }
        
        .donation-modal-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: heartbeat 1.5s ease-in-out infinite;
        }
        
        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .donation-modal h3 {
            font-size: 1.5rem;
            color: #182848;
            margin-bottom: 0.8rem;
            font-weight: 700;
        }
        
        .donation-modal p {
            color: #666;
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }
        
        .donation-modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .donation-modal-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .donation-modal-btn.primary {
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        .donation-modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.5);
        }
        
        .donation-modal-btn.secondary {
            background: rgba(0, 0, 0, 0.08);
            color: #666;
        }
        
        .donation-modal-btn.secondary:hover {
            background: rgba(0, 0, 0, 0.15);
        }
        
        .donation-modal-tip {
            font-size: 0.85rem;
            color: #999;
            margin-top: 1rem;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æèµ å¼¹çª— */
        body.dark-mode .donation-modal {
            background: #2a2a3e;
        }
        
        body.dark-mode .donation-modal h3 {
            color: #e0e0e0;
        }
        
        body.dark-mode .donation-modal p {
            color: #a0a0a0;
        }
        
        body.dark-mode .donation-modal-close {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }
        
        body.dark-mode .donation-modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }
        
        /* å…¬å‘Šå¼¹çª—æ ·å¼ */
        .announcement-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .announcement-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .announcement-modal {
            background: white;
            border-radius: 20px;
            padding: 0;
            max-width: 550px;
            width: 90%;
            max-height: 80vh;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transform: scale(0.8) translateY(20px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .announcement-modal-overlay.show .announcement-modal {
            transform: scale(1) translateY(0);
        }
        
        .announcement-modal-header {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .announcement-modal-header .icon {
            font-size: 2rem;
        }
        
        .announcement-modal-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }
        
        .announcement-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 32px;
            height: 32px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .announcement-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }
        
        .announcement-modal-content {
            padding: 1.5rem 2rem;
            overflow-y: auto;
            flex: 1;
            line-height: 1.8;
            color: #444;
        }
        
        .announcement-modal-content h1,
        .announcement-modal-content h2,
        .announcement-modal-content h3 {
            color: #182848;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .announcement-modal-content h1 { font-size: 1.5rem; }
        .announcement-modal-content h2 { font-size: 1.3rem; }
        .announcement-modal-content h3 { font-size: 1.1rem; }
        
        .announcement-modal-content p {
            margin-bottom: 0.8rem;
        }
        
        .announcement-modal-content ul,
        .announcement-modal-content ol {
            padding-left: 1.5rem;
            margin-bottom: 0.8rem;
        }
        
        .announcement-modal-content li {
            margin-bottom: 0.4rem;
        }
        
        .announcement-modal-content hr {
            border: none;
            border-top: 1px solid #eee;
            margin: 1rem 0;
        }
        
        .announcement-modal-content em {
            color: #888;
            font-style: italic;
        }
        
        .announcement-modal-footer {
            padding: 1rem 2rem 1.5rem;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            border-top: 1px solid #eee;
        }
        
        .announcement-modal-btn {
            padding: 12px 24px;
            border-radius: 25px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .announcement-modal-btn.primary {
            background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .announcement-modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.5);
        }
        
        .announcement-modal-btn.secondary {
            background: rgba(0, 0, 0, 0.08);
            color: #666;
        }
        
        .announcement-modal-btn.secondary:hover {
            background: rgba(0, 0, 0, 0.15);
        }
        
        .announcement-modal-btn.danger {
            background: linear-gradient(135deg, #f44336 0%, #e91e63 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }
        
        .announcement-modal-btn.danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(244, 67, 54, 0.5);
        }
        
        /* å…¬å‘Šä¸­å¿ƒæŒ‰é’®æ ·å¼ */
        .announcement-center-btn {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
        }
        
        .announcement-center-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }
        
        .announcement-center-btn .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }
        
        .announcement-center-btn .badge.hidden {
            display: none;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„å…¬å‘Šå¼¹çª— */
        body.dark-mode .announcement-modal {
            background: #2a2a3e;
        }
        
        body.dark-mode .announcement-modal-content {
            color: #a0a0a0;
        }
        
        body.dark-mode .announcement-modal-content h1,
        body.dark-mode .announcement-modal-content h2,
        body.dark-mode .announcement-modal-content h3 {
            color: #e0e0e0;
        }
        
        body.dark-mode .announcement-modal-content hr {
            border-top-color: #444;
        }
        
        body.dark-mode .announcement-modal-footer {
            border-top-color: #444;
        }
        
        body.dark-mode .announcement-modal-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ccc;
        }
        
        .container {
            max-width: 1300px;
            margin: 2.5rem auto;
            padding: 0 1.5rem;
        }
        
        /* å·¥å…·å¡ç‰‡å®¹å™¨ */
        .tools-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2.2rem;
            margin: 2.5rem 0;
        }
        
        /* å·¥å…·å¡ç‰‡ */
        .tool-card {
            background: white;
            border-radius: 18px;
            padding: 2.5rem 2rem;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transform: translateY(0);
        }
        
        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
            border-radius: 18px 18px 0 0;
        }
        
        .tool-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .tool-card h2 {
            color: #182848;
            margin-bottom: 1.3rem;
            font-size: 1.9rem;
            font-weight: 700;
        }
        
        .tool-card p {
            color: #555;
            margin-bottom: 1.8rem;
            line-height: 1.7;
            font-size: 1.15rem;
        }
        
        .tool-card button {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border: none;
            padding: 1.1rem 2.3rem;
            font-size: 1.15rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 18px rgba(75, 108, 183, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .tool-card button:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(75, 108, 183, 0.6);
        }
        
        .tool-card button:active {
            transform: scale(0.95);
        }
        
        /* å·¥å…·å¡ç‰‡å›¾æ ‡ */
        .tool-icon {
            font-size: 3.5rem;
            margin-bottom: 1.5rem;
            color: #4b6cb7;
            transition: all 0.3s ease;
            display: block;
        }
        
        .tool-card:hover .tool-icon {
            transform: scale(1.2) rotate(5deg);
        }
        
        /* å­¦ç”Ÿç®¡ç†åŒºåŸŸ */
        .student-management-container {
            transition: all 0.4s ease;
        }
        
        .student-management-container.hidden {
            display: none;
        }
        
        .student-management {
            background: white;
            border-radius: 18px;
            padding: 2.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            margin: 2.5rem 0;
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: visible;
        }
        
        .student-management::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
            border-radius: 18px 18px 0 0;
        }
        
        .student-management.hidden {
            transform: translateY(-20px);
            opacity: 0;
            pointer-events: none;
            max-height: 0;
            padding: 0 !important;
            margin: 0 !important;
            border: none;
            overflow: hidden;
            display: none;
        }
        
        .student-management h2 {
            color: #182848;
            margin-bottom: 1.8rem;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
        }
        
        .student-input-section {
            margin-bottom: 2.2rem;
        }
        
        .input-group {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
        }
        
        .input-group input {
            flex: 1;
            min-width: 150px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .input-group input:focus {
            border-color: #4b6cb7;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
            outline: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(75, 108, 183, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(75, 108, 183, 0.6);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn:disabled {
            background: linear-gradient(135deg, #cccccc, #999999);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn.add {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }
        
        .btn.import {
            background: linear-gradient(135deg, #9C27B0, #E040FB);
        }
        
        .btn.clear {
            background: linear-gradient(135deg, #FF5722, #FF9800);
        }
        
        .btn.toggle-students {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            display: block;
            margin: 1.8rem auto;
            padding: 1.2rem 2.5rem;
            font-size: 1.2rem;
        }
        
        .btn.feedback {
            background: linear-gradient(135deg, #FF9800, #FFC107);
            display: block;
            margin: 1.2rem auto;
            padding: 1.1rem 2.2rem;
            font-size: 1.15rem;
        }
        
        .batch-import {
            margin: 1.3rem 0;
            padding: 1.3rem;
            background: rgba(227, 242, 253, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(179, 219, 255, 0.5);
        }
        
        .batch-import h3 {
            color: #182848;
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .batch-import textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            margin-bottom: 1.2rem;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .batch-import textarea:focus {
            border-color: #4b6cb7;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
            outline: none;
        }
        
        .file-import {
            margin: 1.3rem 0;
            padding: 1.3rem;
            background: rgba(227, 242, 253, 0.8);
            border-radius: 12px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(179, 219, 255, 0.5);
        }
        
        .file-import h3 {
            color: #182848;
            margin-bottom: 0.8rem;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        .file-import input {
            width: 100%;
            margin-bottom: 1.2rem;
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .file-import input:focus {
            border-color: #4b6cb7;
            box-shadow: 0 0 0 3px rgba(75, 108, 183, 0.2);
            outline: none;
        }
        
        .student-list-container {
            max-height: 320px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 12px;
            padding: 1.2rem;
            background: rgba(248, 249, 250, 0.9);
            margin-top: 1.5rem;
            backdrop-filter: blur(5px);
            /* ç¡®ä¿æ»šåŠ¨æ¡å§‹ç»ˆå¯ç”¨ */
            -webkit-overflow-scrolling: touch;
            /* ç¡®ä¿åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸æ»šåŠ¨ */
            scrollbar-width: thin;
            scrollbar-color: #4b6cb7 rgba(248, 249, 250, 0.9);
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ï¼ˆWebKitæµè§ˆå™¨ï¼‰ */
        .student-list-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .student-list-container::-webkit-scrollbar-track {
            background: rgba(248, 249, 250, 0.9);
            border-radius: 4px;
        }
        
        .student-list-container::-webkit-scrollbar-thumb {
            background: #4b6cb7;
            border-radius: 4px;
        }
        
        .student-list-container::-webkit-scrollbar-thumb:hover {
            background: #3a5795;
        }
        
        .student-item {
            padding: 1rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: slideIn 0.3s ease;
            transition: all 0.2s ease;
        }
        
        .student-item:hover {
            background: rgba(227, 242, 253, 0.6);
            border-radius: 8px;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .student-info {
            flex: 1;
        }
        
        .student-id {
            font-weight: bold;
            color: #4b6cb7;
        }
        
        .remove-student {
            background: #ff416c;
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }
        
        .remove-student:hover {
            background: #ff1a4f;
            transform: scale(1.1);
        }
        
        .student-summary {
            display: flex;
            justify-content: center;
            gap: 2.2rem;
            margin-top: 1.8rem;
            flex-wrap: wrap;
        }
        
        .summary-card {
            background: rgba(227, 242, 253, 0.8);
            border-radius: 14px;
            padding: 1.7rem;
            text-align: center;
            min-width: 160px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(179, 219, 255, 0.5);
            transition: all 0.3s ease;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }
        
        .summary-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #182848;
        }
        
        .summary-label {
            font-size: 1.1rem;
            color: #555;
            margin-top: 0.5rem;
        }
        
        .instructions {
            background: rgba(227, 242, 253, 0.8);
            border-radius: 18px;
            padding: 2.2rem;
            margin-top: 2.8rem;
            text-align: left;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(179, 219, 255, 0.5);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .instructions h3 {
            color: #182848;
            margin-bottom: 1.8rem;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .instructions ol {
            padding-left: 2.2rem;
        }
        
        .instructions li {
            margin-bottom: 1rem;
            line-height: 1.8;
            font-size: 1.2rem;
            color: #444;
        }
        
        .instructions strong {
            color: #4b6cb7;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <header>
        <div style="position: relative; width: 100%;">
            <div style="position: absolute; top: 1rem; right: 1rem; display: flex; gap: 0.5rem; z-index: 10;">
                <button class="announcement-center-btn" id="announcementCenterBtn" onclick="openAnnouncementCenter()" title="å…¬å‘Šä¸­å¿ƒ" style="display: none;">
                    ğŸ“¢ <span data-lang="announcement_center">å…¬å‘Š</span>
                    <span class="badge hidden" id="announcementBadge">1</span>
                </button>
                <button class="language-switcher" id="languageSwitcher">English</button>
                <button class="theme-switcher" id="themeSwitcher">é»‘å¤œæ¨¡å¼</button>
                <button class="install-pwa-btn" id="installPwaBtn" style="background: linear-gradient(135deg, #4CAF50, #8BC34A); border: none; padding: 0.5rem 1rem; border-radius: 20px; color: white; cursor: pointer; font-weight: 500; transition: all 0.3s ease; backdrop-filter: blur(5px); display: none;" title="å®‰è£…åº”ç”¨åˆ°æ¡Œé¢">å®‰è£…åº”ç”¨</button>
                <button class="egg-button" id="eggButton" style="background: linear-gradient(135deg, #FFD700, #FFA500); border: none; padding: 0.5rem 1rem; border-radius: 20px; color: white; cursor: pointer; font-weight: 500; transition: all 0.3s ease; backdrop-filter: blur(5px); display: none;" onclick="triggerEasterEgg()">å½©è›‹</button>
            </div>
            <h1>æ•™å¸ˆå·¥å…·ç®±</h1>
            <p>ä¸“ä¸ºæ•™å¸ˆè®¾è®¡çš„å®ç”¨å·¥å…·é›†åˆ</p>
        </div>
    </header>
    
    <!-- éšè—çš„å½©è›‹è§¦å‘å…ƒç´  -->
    <div id="easterEggTrigger" style="position: fixed; bottom: 10px; right: 10px; width: 50px; height: 50px; cursor: pointer; z-index: 9999;"></div>
    
    <div class="container">
        <!-- å·¥å…·å¡ç‰‡ -->
        <div class="tools-container">
            <div class="tool-card" id="sound-detector-card">
                <div class="tool-icon">ğŸ”Š</div>
                <h2 data-lang="sound_detector_title">å£°éŸ³æ£€æµ‹å™¨</h2>
                <p data-lang="sound_detector_desc">å®æ—¶æ£€æµ‹ç¯å¢ƒå£°éŸ³å¼ºåº¦ï¼Œå£°éŸ³è¶Šé«˜å°çƒè¶Šé«˜</p>
                <button onclick="navigateTo('src/pages/sound-detector.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="roll-call-card">
                <div class="tool-icon">ğŸ²</div>
                <h2 data-lang="roll_call_title">éšæœºç‚¹åå™¨</h2>
                <p data-lang="roll_call_desc">éšæœºé€‰æ‹©å­¦ç”Ÿå›ç­”é—®é¢˜ï¼Œå¢åŠ è¯¾å ‚äº’åŠ¨</p>
                <button onclick="navigateTo('src/pages/roll-call.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="timer-card">
                <div class="tool-icon">â±ï¸</div>
                <h2 data-lang="timer_title">è¯¾å ‚è®¡æ—¶å™¨</h2>
                <p data-lang="timer_desc">ç®¡ç†è¯¾å ‚æ´»åŠ¨æ—¶é—´ï¼Œæé«˜æ•™å­¦æ•ˆç‡</p>
                <button onclick="navigateTo('src/pages/timer.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="clock-card">
                <div class="tool-icon">ğŸ•</div>
                <h2 data-lang="clock_title">å…¨å±æ—¶é’Ÿ</h2>
                <p data-lang="clock_desc">è¶…å¤§æ˜¾ç¤ºæ—¶é’Ÿï¼Œæ”¯æŒå¤šç§é¢œè‰²å’Œæ ¼å¼ï¼Œä¸€é”®å…¨å±</p>
                <button onclick="navigateTo('src/pages/clock.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="grouping-card">
                <div class="tool-icon">ğŸ‘¥</div>
                <h2 data-lang="grouping_title">å°ç»„åˆ†ç»„å™¨</h2>
                <p data-lang="grouping_desc">éšæœºåˆ†ç»„å­¦ç”Ÿï¼Œä¾¿äºå°ç»„æ´»åŠ¨</p>
                <button onclick="navigateTo('src/pages/grouping.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="whiteboard-card">
                <div class="tool-icon">âœï¸</div>
                <h2 data-lang="whiteboard_title">ç”µå­ç™½æ¿</h2>
                <p data-lang="whiteboard_desc">åœ¨çº¿ç»˜åˆ¶å’Œæ¼”ç¤ºï¼Œæ”¯æŒå¤šç‚¹è§¦æ§</p>
                <button onclick="navigateTo('src/pages/whiteboard.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="tracker-card">
                <div class="tool-icon">ğŸ“ˆ</div>
                <h2 data-lang="tracker_title">è¯¾å ‚è¡¨ç°è®°å½•å™¨</h2>
                <p data-lang="tracker_desc">è®°å½•å­¦ç”Ÿè¯¾å ‚è¡¨ç°ï¼Œæå‡æ•™å­¦æ•ˆæœ</p>
                <button onclick="navigateTo('src/pages/classroom-tracker.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="copybook-card">
                <div class="tool-icon">âœï¸</div>
                <h2 data-lang="copybook_title">ä¸´æ‘¹æœ¬ç”Ÿæˆå™¨</h2>
                <p data-lang="copybook_desc">ç”Ÿæˆä¸­è‹±æ–‡ä¸´æ‘¹æœ¬ï¼Œæ”¯æŒè‡ªå®šä¹‰å­—ä½“</p>
                <button onclick="navigateTo('src/pages/copybook-generator.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="math-card">
                <div class="tool-icon">ğŸ”¢</div>
                <h2 data-lang="math_title">è®¡ç®—é¢˜ç”Ÿæˆå™¨</h2>
                <p data-lang="math_desc">ç”Ÿæˆè‡ªå®šä¹‰è®¡ç®—é¢˜ï¼Œæ”¯æŒå¤šç§è¿ç®—ç¬¦</p>
                <button onclick="navigateTo('src/pages/math-generator.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="3d-viewer-card">
                <div class="tool-icon">ğŸ§±</div>
                <h2 data-lang="3d_viewer_title">3Dè§‚å¯Ÿç‰©ä½“</h2>
                <p data-lang="3d_viewer_desc">åˆ›å»ºã€ç¼–è¾‘å’Œè§‚å¯Ÿ3Dç‰©ä½“ï¼Œæ”¯æŒå¤šè§’åº¦æŸ¥çœ‹</p>
                <button onclick="navigateTo('src/pages/3d-viewer.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="periodic-table-card">
                <div class="tool-icon">âš›ï¸</div>
                <h2 data-lang="periodic_table_title">å…ƒç´ å‘¨æœŸè¡¨</h2>
                <p data-lang="periodic_table_desc">äº¤äº’å¼å…ƒç´ å‘¨æœŸè¡¨ï¼Œç‚¹å‡»æŸ¥çœ‹å…ƒç´ è¯¦æƒ…</p>
                <button onclick="navigateTo('src/pages/periodic-table.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="teacher-camera-card" style="display: none;">
                <div class="tool-icon">ğŸ“·</div>
                <h2 data-lang="teacher_camera_title">æ•™å¸ˆæ‘„åƒå¤´</h2>
                <p data-lang="teacher_camera_desc">å°†æ•™å¸ˆæ‰‹æœºæ‘„åƒå¤´ç”»é¢æŠ•å±åˆ°ç”µè„‘ä¸Š</p>
                <button onclick="navigateTo('src/pages/teacher-camera-vercel.html')" data-lang="use_now">ç«‹å³ä½¿ç”¨</button>
            </div>

            <div class="tool-card" id="donation-card">
                <div class="tool-icon">â¤ï¸</div>
                <h2 data-lang="donation_title">æ‰“èµæ”¯æŒ</h2>
                <p data-lang="donation_desc">å¦‚æœæ‚¨å–œæ¬¢è¿™äº›å·¥å…·ï¼Œæ¬¢è¿æ‰“èµæ”¯æŒ</p>
                <button onclick="navigateTo('src/pages/donation.html')" data-lang="support_now">å‰å¾€æ”¯æŒ</button>
            </div>
        </div>
        
        <!-- åˆ‡æ¢å­¦ç”Ÿç®¡ç†æŒ‰é’® -->
        <button id="toggleStudentsBtn" class="btn toggle-students" data-lang="manage_students">ç®¡ç†å­¦ç”Ÿä¿¡æ¯</button>
        
        <!-- å­¦ç”Ÿç®¡ç†åŒºåŸŸ -->
        <div class="student-management-container hidden">
            <div class="student-management" id="studentManagement">
                <h2 data-lang="student_management">å­¦ç”Ÿç®¡ç†</h2>
            
            <div class="student-input-section">
                <div class="input-group">
                    <input type="text" id="studentId" placeholder="å­¦å·ï¼ˆå¯é€‰ï¼‰" data-lang-placeholder="student_id_placeholder">
                    <input type="text" id="studentName" placeholder="å­¦ç”Ÿå§“å" data-lang-placeholder="student_name_placeholder">
                    <button id="addStudentBtn" class="btn add" data-lang="add_student">æ·»åŠ å­¦ç”Ÿ</button>
                </div>
                
                <div class="batch-import">
                    <h3 data-lang="batch_import_title">æ‰¹é‡å¯¼å…¥ï¼ˆCSVæ ¼å¼ï¼šå­¦å·,å§“åï¼‰</h3>
                    <textarea id="csvInput" placeholder="ä¾‹å¦‚ï¼š&#10;2021001,å¼ ä¸‰&#10;2021002,æå››&#10;2021003,ç‹äº”" data-lang-placeholder="csv_example"></textarea>
                    <button id="importBtn" class="btn import" data-lang="import_csv">å¯¼å…¥CSV</button>
                </div>
                
                <div class="file-import">
                    <h3 data-lang="file_import_title">æ–‡ä»¶å¯¼å…¥ï¼ˆæ”¯æŒCSVã€TXTã€JSONæ ¼å¼ï¼‰</h3>
                    <input type="file" id="fileInput" accept=".csv,.txt,.json">
                    <button id="importFileBtn" class="btn import" data-lang="import_file">å¯¼å…¥æ–‡ä»¶</button>
                    <div id="fileInfo" style="margin-top: 0.8rem; font-size: 1rem; color: #666;"></div>
                </div>
                
                <button id="clearStudentsBtn" class="btn clear" data-lang="clear_students">æ¸…ç©ºå­¦ç”Ÿåˆ—è¡¨</button>
            </div>
            
            <div class="student-list-container">
                <div id="studentList">
                    <div class="empty-list" data-lang="no_students">æš‚æ— å­¦ç”Ÿï¼Œè¯·æ·»åŠ å­¦ç”Ÿ</div>
                </div>
            </div>
            
            <div class="student-summary">
                <div class="summary-card">
                    <div class="summary-value" id="totalStudents">0</div>
                    <div class="summary-label" data-lang="total_students">æ€»å­¦ç”Ÿæ•°</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="totalGroups">0</div>
                    <div class="summary-label" data-lang="suggested_groups">å»ºè®®åˆ†ç»„æ•°</div>
                </div>
            </div>
        </div>
    </div>
        
        </div>
        </div>
        
        <!-- PWAå®‰è£…æŒ‰é’® -->
        <button id="installPwaBtn" class="btn install-pwa" style="display: none; background: linear-gradient(135deg, #4CAF50, #8BC34A); margin: 1.5rem auto; padding: 1rem 2rem; font-size: 1.1rem;" title="å®‰è£…åº”ç”¨åˆ°æ¡Œé¢">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: middle; margin-right: 0.5rem;">
                <path d="M19 9H15V3H9V9H5L12 16L19 9ZM5 18V20H19V18H5Z" fill="white"/>
            </svg>
            å®‰è£…åº”ç”¨åˆ°æ¡Œé¢
        </button>
        
        <!-- åé¦ˆå»ºè®®æŒ‰é’® -->
        <button id="feedbackBtn" class="btn feedback" data-lang="feedback">åé¦ˆå»ºè®®</button>
        
        
    </div>
    
    <div class="container">
        <div class="instructions">
            <h3 data-lang="instructions">ä½¿ç”¨è¯´æ˜</h3>
            <ol>
                <li><strong data-lang="student_management_guide">å­¦ç”Ÿç®¡ç†</strong> - <span data-lang="student_management_desc">ç‚¹å‡»"ç®¡ç†å­¦ç”Ÿä¿¡æ¯"æŒ‰é’®æ˜¾ç¤ºå­¦ç”Ÿç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå•ä¸ªæ·»åŠ ã€æ‰¹é‡å¯¼å…¥å’Œæ–‡ä»¶å¯¼å…¥</span></li>
                <li><strong data-lang="sound_detector_guide">å£°éŸ³æ£€æµ‹å™¨</strong> - <span data-lang="sound_detector_desc2">å®æ—¶æ£€æµ‹ç¯å¢ƒå£°éŸ³å¼ºåº¦ï¼Œå£°éŸ³è¶Šé«˜å°çƒè¶Šé«˜ï¼Œå¯ç”¨äºè¯¾å ‚æ´»è·ƒåº¦ç›‘æµ‹</span></li>
                <li><strong data-lang="roll_call_guide">éšæœºç‚¹åå™¨</strong> - <span data-lang="roll_call_desc2">éšæœºé€‰æ‹©å­¦ç”Ÿå›ç­”é—®é¢˜ï¼Œå¢åŠ è¯¾å ‚äº’åŠ¨ï¼Œæ”¯æŒå¯¼å…¥å­¦ç”Ÿåå•</span></li>
                <li><strong data-lang="timer_guide">è¯¾å ‚è®¡æ—¶å™¨</strong> - <span data-lang="timer_desc2">ç®¡ç†è¯¾å ‚æ´»åŠ¨æ—¶é—´ï¼Œæé«˜æ•™å­¦æ•ˆç‡ï¼Œæ”¯æŒå…¨å±æ¨¡å¼å’Œé¢„è®¾æ—¶é—´</span></li>
                <li><strong data-lang="clock_guide">å…¨å±æ—¶é’Ÿ</strong> - <span data-lang="clock_desc2">è¶…å¤§æ˜¾ç¤ºæ—¶é’Ÿï¼Œæ”¯æŒ8ç§é¢œè‰²ä¸»é¢˜ã€12/24å°æ—¶åˆ¶åˆ‡æ¢ã€ä¸€é”®å…¨å±æ˜¾ç¤º</span></li>
                <li><strong data-lang="grouping_guide">å°ç»„åˆ†ç»„å™¨</strong> - <span data-lang="grouping_desc2">éšæœºåˆ†ç»„å­¦ç”Ÿï¼Œä¾¿äºå°ç»„æ´»åŠ¨ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç»„äººæ•°</span></li>
                <li><strong data-lang="whiteboard_guide">ç”µå­ç™½æ¿</strong> - <span data-lang="whiteboard_desc2">åœ¨çº¿ç»˜åˆ¶å’Œæ¼”ç¤ºï¼Œæ”¯æŒå¤šç‚¹è§¦æ§ã€å¤šç§é¢œè‰²å’Œçº¿æ¡ç²—ç»†è°ƒèŠ‚</span></li>
                <li><strong data-lang="tracker_guide">è¯¾å ‚è¡¨ç°è®°å½•å™¨</strong> - <span data-lang="tracker_desc2">è®°å½•å­¦ç”Ÿè¯¾å ‚è¡¨ç°ï¼Œå¸®åŠ©æ•™å¸ˆäº†è§£å­¦ç”Ÿå‚ä¸åº¦</span></li>
                <li><strong data-lang="feedback_guide">åé¦ˆå»ºè®®</strong> - <span data-lang="feedback_desc">ç‚¹å‡»"åé¦ˆå»ºè®®"æŒ‰é’®æäº¤æ‚¨çš„å®è´µæ„è§</span></li>
            </ol>
        </div>
    </div>
    
    <footer>
        <p data-lang="footer_text">&copy; 2025 æ•™å¸ˆå·¥å…·ç®± - ä¸“ä¸ºæ•™å¸ˆè®¾è®¡</p>
    </footer>
    
    <!-- å…¬å‘Šå¼¹çª— -->
    <div class="announcement-modal-overlay" id="announcementModal">
        <div class="announcement-modal">
            <button class="announcement-modal-close" onclick="closeAnnouncementModal()">&times;</button>
            <div class="announcement-modal-header">
                <span class="icon">ğŸ“¢</span>
                <h3 id="announcementModalTitle">å…¬å‘Š</h3>
            </div>
            <div class="announcement-modal-content" id="announcementModalContent">
                <!-- å…¬å‘Šå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
            <div class="announcement-modal-footer">
                <button class="announcement-modal-btn primary" onclick="closeAnnouncementModal()" id="announcementCloseBtn">æˆ‘çŸ¥é“äº†</button>
                <button class="announcement-modal-btn danger" onclick="permanentlyCloseAnnouncement()" id="announcementPermanentBtn">ä¸å†æ˜¾ç¤ºæ­¤å…¬å‘Š</button>
            </div>
        </div>
    </div>
    
    <!-- æèµ æç¤ºå¼¹çª— -->
    <div class="donation-modal-overlay" id="donationModal">
        <div class="donation-modal">
            <button class="donation-modal-close" onclick="closeDonationModal()">&times;</button>
            <div class="donation-modal-icon">â¤ï¸</div>
            <h3 id="donationModalTitle">å–œæ¬¢è¿™ä¸ªå·¥å…·å—ï¼Ÿ</h3>
            <p id="donationModalMessage">å¦‚æœè¿™äº›å·¥å…·å¯¹æ‚¨çš„æ•™å­¦æœ‰å¸®åŠ©ï¼Œæ¬¢è¿æ‰“èµæ”¯æŒä½œè€…ç»§ç»­å¼€å‘æ›´å¤šå®ç”¨åŠŸèƒ½ï¼</p>
            <div class="donation-modal-buttons">
                <button class="donation-modal-btn primary" onclick="goToDonation()" id="donationModalBtn">å»æ”¯æŒä¸€ä¸‹</button>
                <button class="donation-modal-btn secondary" onclick="closeDonationModal()" id="donationModalLater">ä¸‹æ¬¡å†è¯´</button>
            </div>
            <div class="donation-modal-tip" id="donationModalTip">ğŸ’¡ æ‚¨çš„æ”¯æŒæ˜¯ä½œè€…æŒç»­æ›´æ–°çš„åŠ¨åŠ›</div>
        </div>
    </div>
    
    <script>
        // PWAå®‰è£…ç›¸å…³å˜é‡
        let deferredPrompt;
        const installPwaBtn = document.getElementById('installPwaBtn');
        
        // ç›‘å¬beforeinstallpromptäº‹ä»¶
        window.addEventListener('beforeinstallprompt', (e) => {
            // é˜»æ­¢é»˜è®¤çš„å®‰è£…æç¤º
            e.preventDefault();
            // ä¿å­˜äº‹ä»¶ä»¥ä¾¿ç¨åè§¦å‘
            deferredPrompt = e;
            // æ˜¾ç¤ºå®‰è£…æŒ‰é’®
            installPwaBtn.style.display = 'block';
        });
        
        // å®‰è£…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        installPwaBtn.addEventListener('click', () => {
            // å¦‚æœæœ‰å»¶è¿Ÿçš„å®‰è£…æç¤ºï¼Œåˆ™è§¦å‘å®ƒ
            if (deferredPrompt) {
                deferredPrompt.prompt();
                
                // ç­‰å¾…ç”¨æˆ·å“åº”
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ç”¨æˆ·æ¥å—äº†PWAå®‰è£…');
                        // éšè—å®‰è£…æŒ‰é’®
                        installPwaBtn.style.display = 'none';
                        // æ ‡è®°åº”ç”¨å·²å®‰è£…
                        localStorage.setItem('pwaInstalled', 'true');
                    } else {
                        console.log('ç”¨æˆ·æ‹’ç»äº†PWAå®‰è£…');
                        // ç”¨æˆ·æ‹’ç»åä»ç„¶æ˜¾ç¤ºæŒ‰é’®ï¼Œå…è®¸å†æ¬¡å°è¯•
                    }
                    deferredPrompt = null;
                });
            }
        });
        
        // ç›‘å¬appinstalledäº‹ä»¶
        window.addEventListener('appinstalled', () => {
            console.log('PWAåº”ç”¨å·²æˆåŠŸå®‰è£…');
            // éšè—å®‰è£…æŒ‰é’®
            installPwaBtn.style.display = 'none';
            deferredPrompt = null;
        });
        
        // æ³¨å†ŒæœåŠ¡å·¥ä½œè€…
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                // æ£€æŸ¥æ˜¯å¦åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¿è¡Œ
                if (window.location.protocol === 'file:') {
                    console.log('Service Worker not supported in file:// protocol');
                    return;
                }
                
                navigator.serviceWorker.register('sw.js')
                .then(function(registration) {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    
                    // æ£€æŸ¥æ›´æ–°
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('[SW] New version found, installing...');
                        
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                // æ–°ç‰ˆæœ¬å·²å®‰è£…ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°
                                console.log('[SW] New version installed, prompting user to refresh');
                                if (confirm(currentLanguage === 'zh' ?
                                    'å‘ç°æ–°ç‰ˆæœ¬ï¼æ˜¯å¦ç«‹å³åˆ·æ–°é¡µé¢ä»¥è·å–æœ€æ–°å†…å®¹ï¼Ÿ' :
                                    'New version available! Refresh the page to get the latest content?')) {
                                    // é€šçŸ¥Service Workerè·³è¿‡ç­‰å¾…
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    window.location.reload();
                                }
                            }
                        });
                    });
                    
                    // å®šæœŸæ£€æŸ¥æ›´æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
                    setInterval(() => {
                        registration.update();
                    }, 5 * 60 * 1000);
                })
                .catch(function(err) {
                    console.log('ServiceWorker registration failed: ', err);
                });
                
                // ç›‘å¬æ§åˆ¶å™¨å˜åŒ–ï¼ˆå½“æ–°çš„Service Workeræ¥ç®¡æ—¶ï¼‰
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    console.log('[SW] Controller changed, reloading page');
                });
            });
        } else {
            console.log('Service Workers are not supported in this browser.');
        }
        
        // é¡µé¢åŠ è½½æ—¶é»˜è®¤éšè—å­¦ç”Ÿç®¡ç†åŒºåŸŸ
        document.addEventListener('DOMContentLoaded', function() {
            const studentManagementContainer = document.querySelector('.student-management-container');
            if (studentManagementContainer) {
                studentManagementContainer.classList.add('hidden');
            }
        });
        
        // å¤šè¯­è¨€æ”¯æŒ
        const languages = {
            zh: {
                sound_detector_title: "å£°éŸ³æ£€æµ‹å™¨",
                sound_detector_desc: "å®æ—¶æ£€æµ‹ç¯å¢ƒå£°éŸ³å¼ºåº¦ï¼Œå£°éŸ³è¶Šé«˜å°çƒè¶Šé«˜",
                roll_call_title: "éšæœºç‚¹åå™¨",
                roll_call_desc: "éšæœºé€‰æ‹©å­¦ç”Ÿå›ç­”é—®é¢˜ï¼Œå¢åŠ è¯¾å ‚äº’åŠ¨",
                timer_title: "è¯¾å ‚è®¡æ—¶å™¨",
                timer_desc: "ç®¡ç†è¯¾å ‚æ´»åŠ¨æ—¶é—´ï¼Œæé«˜æ•™å­¦æ•ˆç‡",
                clock_title: "å…¨å±æ—¶é’Ÿ",
                clock_desc: "è¶…å¤§æ˜¾ç¤ºæ—¶é’Ÿï¼Œæ”¯æŒå¤šç§é¢œè‰²å’Œæ ¼å¼ï¼Œä¸€é”®å…¨å±",
                grouping_title: "å°ç»„åˆ†ç»„å™¨",
                grouping_desc: "éšæœºåˆ†ç»„å­¦ç”Ÿï¼Œä¾¿äºå°ç»„æ´»åŠ¨",
                whiteboard_title: "ç”µå­ç™½æ¿",
                whiteboard_desc: "åœ¨çº¿ç»˜åˆ¶å’Œæ¼”ç¤ºï¼Œæ”¯æŒå¤šç‚¹è§¦æ§",
                tracker_title: "è¯¾å ‚è¡¨ç°è®°å½•å™¨",
                tracker_desc: "è®°å½•å­¦ç”Ÿè¯¾å ‚è¡¨ç°ï¼Œæå‡æ•™å­¦æ•ˆæœ",
                copybook_title: "ä¸´æ‘¹æœ¬ç”Ÿæˆå™¨",
                copybook_desc: "ç”Ÿæˆä¸­è‹±æ–‡ä¸´æ‘¹æœ¬ï¼Œæ”¯æŒè‡ªå®šä¹‰å­—ä½“",
                math_title: "è®¡ç®—é¢˜ç”Ÿæˆå™¨",
                math_desc: "ç”Ÿæˆè‡ªå®šä¹‰è®¡ç®—é¢˜ï¼Œæ”¯æŒå¤šç§è¿ç®—ç¬¦",
                "3d_viewer_title": "3Dè§‚å¯Ÿç‰©ä½“",
                "3d_viewer_desc": "åˆ›å»ºã€ç¼–è¾‘å’Œè§‚å¯Ÿ3Dç‰©ä½“ï¼Œæ”¯æŒå¤šè§’åº¦æŸ¥çœ‹",
                periodic_table_title: "å…ƒç´ å‘¨æœŸè¡¨",
                periodic_table_desc: "äº¤äº’å¼å…ƒç´ å‘¨æœŸè¡¨ï¼Œç‚¹å‡»æŸ¥çœ‹å…ƒç´ è¯¦æƒ…",
                "teacher_camera_title": "Teacher Camera",
                "teacher_camera_desc": "Stream teacher's mobile camera feed to computer screen",
                teacher_camera_title: "æ•™å¸ˆæ‘„åƒå¤´",
                teacher_camera_desc: "å°†æ•™å¸ˆæ‰‹æœºæ‘„åƒå¤´ç”»é¢æŠ•å±åˆ°ç”µè„‘ä¸Š",
                use_now: "ç«‹å³ä½¿ç”¨",
                support_now: "å‰å¾€æ”¯æŒ",
                student_management: "å­¦ç”Ÿç®¡ç†",
                student_id_placeholder: "å­¦å·ï¼ˆå¯é€‰ï¼‰",
                student_name_placeholder: "å­¦ç”Ÿå§“å",
                add_student: "æ·»åŠ å­¦ç”Ÿ",
                batch_import_title: "æ‰¹é‡å¯¼å…¥ï¼ˆCSVæ ¼å¼ï¼šå­¦å·,å§“åï¼‰",
                csv_example: "ä¾‹å¦‚ï¼š\\n2021001,å¼ ä¸‰\\n2021002,æå››\\n2021003,ç‹äº”",
                import_csv: "å¯¼å…¥CSV",
                file_import_title: "æ–‡ä»¶å¯¼å…¥ï¼ˆæ”¯æŒCSVã€TXTã€JSONæ ¼å¼ï¼‰",
                import_file: "å¯¼å…¥æ–‡ä»¶",
                clear_students: "æ¸…ç©ºå­¦ç”Ÿåˆ—è¡¨",
                no_students: "æš‚æ— å­¦ç”Ÿï¼Œè¯·æ·»åŠ å­¦ç”Ÿ",
                total_students: "æ€»å­¦ç”Ÿæ•°",
                suggested_groups: "å»ºè®®åˆ†ç»„æ•°",
                manage_students: "ç®¡ç†å­¦ç”Ÿä¿¡æ¯",
                feedback: "åé¦ˆå»ºè®®",
                donation_support: "æ‰“èµæ”¯æŒ",
                instructions: "ä½¿ç”¨è¯´æ˜",
                student_management_guide: "å­¦ç”Ÿç®¡ç†",
                student_management_desc: "ç‚¹å‡»\"ç®¡ç†å­¦ç”Ÿä¿¡æ¯\"æŒ‰é’®æ˜¾ç¤ºå­¦ç”Ÿç®¡ç†ç•Œé¢ï¼Œæ”¯æŒå•ä¸ªæ·»åŠ ã€æ‰¹é‡å¯¼å…¥å’Œæ–‡ä»¶å¯¼å…¥",
                sound_detector_guide: "å£°éŸ³æ£€æµ‹å™¨",
                sound_detector_desc2: "å®æ—¶æ£€æµ‹ç¯å¢ƒå£°éŸ³å¼ºåº¦ï¼Œå£°éŸ³è¶Šé«˜å°çƒè¶Šé«˜ï¼Œå¯ç”¨äºè¯¾å ‚æ´»è·ƒåº¦ç›‘æµ‹",
                roll_call_guide: "éšæœºç‚¹åå™¨",
                roll_call_desc2: "éšæœºé€‰æ‹©å­¦ç”Ÿå›ç­”é—®é¢˜ï¼Œå¢åŠ è¯¾å ‚äº’åŠ¨ï¼Œæ”¯æŒå¯¼å…¥å­¦ç”Ÿåå•",
                timer_guide: "è¯¾å ‚è®¡æ—¶å™¨",
                timer_desc2: "ç®¡ç†è¯¾å ‚æ´»åŠ¨æ—¶é—´ï¼Œæé«˜æ•™å­¦æ•ˆç‡ï¼Œæ”¯æŒå…¨å±æ¨¡å¼å’Œé¢„è®¾æ—¶é—´",
                clock_guide: "å…¨å±æ—¶é’Ÿ",
                clock_desc2: "è¶…å¤§æ˜¾ç¤ºæ—¶é’Ÿï¼Œæ”¯æŒ8ç§é¢œè‰²ä¸»é¢˜ã€12/24å°æ—¶åˆ¶åˆ‡æ¢ã€ä¸€é”®å…¨å±æ˜¾ç¤º",
                grouping_guide: "å°ç»„åˆ†ç»„å™¨",
                grouping_desc2: "éšæœºåˆ†ç»„å­¦ç”Ÿï¼Œä¾¿äºå°ç»„æ´»åŠ¨ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ†ç»„äººæ•°",
                whiteboard_guide: "ç”µå­ç™½æ¿",
                whiteboard_desc2: "åœ¨çº¿ç»˜åˆ¶å’Œæ¼”ç¤ºï¼Œæ”¯æŒå¤šç‚¹è§¦æ§ã€å¤šç§é¢œè‰²å’Œçº¿æ¡ç²—ç»†è°ƒèŠ‚",
                tracker_guide: "è¯¾å ‚è¡¨ç°è®°å½•å™¨",
                tracker_desc2: "è®°å½•å­¦ç”Ÿè¯¾å ‚è¡¨ç°ï¼Œå¸®åŠ©æ•™å¸ˆäº†è§£å­¦ç”Ÿå‚ä¸åº¦",
                jiaocai_downloader_guide: "æ•™æä¸‹è½½å™¨",
                jiaocai_downloader_desc2: "å…ç™»å½•ä¸‹è½½å›½å®¶ä¸­å°å­¦æ™ºæ…§æ•™è‚²å¹³å°ç”µå­æ•™æï¼Œæ”¯æŒå°å­¦ã€åˆä¸­ã€é«˜ä¸­å„å­¦æ®µ",
                feedback_guide: "åé¦ˆå»ºè®®",
                feedback_desc: "ç‚¹å‡»\"åé¦ˆå»ºè®®\"æŒ‰é’®æäº¤æ‚¨çš„å®è´µæ„è§",
                footer_text: "Â© 2025 æ•™å¸ˆå·¥å…·ç®± - ä¸“ä¸ºæ•™å¸ˆè®¾è®¡",
                teachers_day_title: "æ•™å¸ˆèŠ‚å¿«ä¹ï¼",
                teachers_day_message: "ç¥æ‚¨æ•™å¸ˆèŠ‚å¿«ä¹ï¼æ„Ÿè°¢æ‚¨å¯¹æ•™è‚²äº‹ä¸šçš„æ— ç§å¥‰çŒ®å’Œè¾›å‹¤ä»˜å‡ºã€‚"
            },
            en: {
                sound_detector_title: "Sound Detector",
                sound_detector_desc: "Real-time detection of ambient sound intensity, the higher the sound, the higher the ball",
                roll_call_title: "Random Roll Call",
                roll_call_desc: "Randomly select students to answer questions, increase classroom interaction",
                timer_title: "Classroom Timer",
                timer_desc: "Manage classroom activity time, improve teaching efficiency",
                clock_title: "Fullscreen Clock",
                clock_desc: "Large display clock with multiple colors and formats, one-click fullscreen",
                grouping_title: "Group Generator",
                grouping_desc: "Randomly group students for group activities",
                whiteboard_title: "Digital Whiteboard",
                whiteboard_desc: "Online drawing and presentation, supports multi-touch",
                tracker_title: "Classroom Performance Tracker",
                tracker_desc: "Record student classroom performance, improve teaching effectiveness",
                copybook_title: "Copybook Generator",
                copybook_desc: "Generate Chinese and English copybooks, support custom fonts",
                math_title: "Math Problem Generator",
                math_desc: "Generate customizable math problems, supports multiple operators",
                "3d_viewer_title": "3D Object Viewer",
                "3d_viewer_desc": "Create, edit and view 3D objects, support multi-angle viewing",
                "periodic_table_title": "Periodic Table",
                "periodic_table_desc": "Interactive periodic table, click to view element details",
                donation_title: "Support Donation",
                donation_desc: "If you like these tools, please consider supporting us",
                use_now: "Use Now",
                support_now: "Go to Support",
                student_management: "Student Management",
                student_id_placeholder: "Student ID (optional)",
                student_name_placeholder: "Student Name",
                add_student: "Add Student",
                batch_import_title: "Batch Import (CSV format: ID,Name)",
                csv_example: "Example:\\n2021001,John\\n2021002,Jane\\n2021003,Bob",
                import_csv: "Import CSV",
                file_import_title: "File Import (supports CSV, TXT, JSON formats)",
                import_file: "Import File",
                clear_students: "Clear Student List",
                no_students: "No students, please add students",
                total_students: "Total Students",
                suggested_groups: "Suggested Groups",
                manage_students: "Manage Students",
                feedback: "Feedback",
                donation_support: "Support Donation",
                instructions: "Instructions",
                student_management_guide: "Student Management",
                student_management_desc: "Click the \"Manage Students\" button to show the student management interface, supports single add, batch import and file import",
                sound_detector_guide: "Sound Detector",
                sound_detector_desc2: "Real-time detection of ambient sound intensity, the higher the sound, the higher the ball, can be used for classroom activity monitoring",
                roll_call_guide: "Random Roll Call",
                roll_call_desc2: "Randomly select students to answer questions, increase classroom interaction, supports importing student list",
                timer_guide: "Classroom Timer",
                timer_desc2: "Manage classroom activity time, improve teaching efficiency, supports fullscreen mode and preset time",
                clock_guide: "Fullscreen Clock",
                clock_desc2: "Large display clock with 8 color themes, 12/24 hour format switching, one-click fullscreen",
                grouping_guide: "Group Generator",
                grouping_desc2: "Randomly group students for group activities, supports custom group size",
                whiteboard_guide: "Digital Whiteboard",
                whiteboard_desc2: "Online drawing and presentation, supports multi-touch, multiple colors and line thickness adjustment",
                tracker_guide: "Classroom Performance Tracker",
                tracker_desc2: "Record student classroom performance, help teachers understand student participation",
                feedback_guide: "Feedback",
                feedback_desc: "Click the \"Feedback\" button to submit your valuable opinions",
                footer_text: "Â© 2025 Teacher Toolkit - Designed for Teachers",
                teachers_day_title: "Happy Teacher's Day!",
                teachers_day_message: "Happy Teacher's Day! Thank you for your selfless dedication and hard work in education."
            }
        };

        // å½“å‰è¯­è¨€
        let currentLanguage = 'zh';

        // åˆ‡æ¢è¯­è¨€
        function switchLanguage() {
            currentLanguage = currentLanguage === 'zh' ? 'en' : 'zh';
            applyLanguage();
            // ä¿å­˜è¯­è¨€è®¾ç½®åˆ°localStorage
            localStorage.setItem('preferredLanguage', currentLanguage);
        }

        // åº”ç”¨è¯­è¨€
        function applyLanguage() {
            // æ›´æ–°è¯­è¨€åˆ‡æ¢æŒ‰é’®æ–‡æœ¬
            const languageSwitcher = document.getElementById('languageSwitcher');
            if (languageSwitcher) {
                languageSwitcher.textContent = currentLanguage === 'zh' ? 'English' : 'ä¸­æ–‡';
            }
            
            // æ›´æ–°æ‰€æœ‰å¸¦æœ‰data-langå±æ€§çš„å…ƒç´ 
            const elements = document.querySelectorAll('[data-lang]');
            elements.forEach(element => {
                const key = element.getAttribute('data-lang');
                if (languages[currentLanguage][key]) {
                    element.textContent = languages[currentLanguage][key];
                }
            });
            
            // æ›´æ–°å¸¦æœ‰data-lang-placeholderå±æ€§çš„å…ƒç´ 
            const placeholderElements = document.querySelectorAll('[data-lang-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-lang-placeholder');
                if (languages[currentLanguage][key]) {
                    element.placeholder = languages[currentLanguage][key];
                }
            });
        }

        // æ£€æŸ¥æ˜¯å¦æ˜¯æ•™å¸ˆèŠ‚ï¼ˆ9æœˆ10æ—¥ï¼‰
        function checkTeachersDay() {
            const today = new Date();
            const month = today.getMonth() + 1; // æœˆä»½ä»0å¼€å§‹ï¼Œæ‰€ä»¥éœ€è¦+1
            const day = today.getDate();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯9æœˆ10æ—¥
            if (month === 9 && day === 10) {
                // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¾ç¤ºè¿‡æ•™å¸ˆèŠ‚ç¥ç¦
                const hasShownTeachersDay = localStorage.getItem('hasShownTeachersDay');
                if (!hasShownTeachersDay) {
                    // æ˜¾ç¤ºæ•™å¸ˆèŠ‚ç¥ç¦å¼¹çª—
                    const title = languages[currentLanguage].teachers_day_title;
                    const message = languages[currentLanguage].teachers_day_message;
                    alert(`${title}\n\n${message}`);
                    
                    // æ ‡è®°ä¸ºå·²æ˜¾ç¤º
                    localStorage.setItem('hasShownTeachersDay', 'true');
                }
            } else {
                // å¦‚æœä¸æ˜¯æ•™å¸ˆèŠ‚ï¼Œæ¸…é™¤æ ‡è®°
                localStorage.removeItem('hasShownTeachersDay');
            }
        }

        // è·å–DOMå…ƒç´ 
        const toggleStudentsBtn = document.getElementById('toggleStudentsBtn');
        const studentManagement = document.getElementById('studentManagement');
        const studentManagementContainer = studentManagement.parentElement;
        const studentId = document.getElementById('studentId');
        const studentName = document.getElementById('studentName');
        const addStudentBtn = document.getElementById('addStudentBtn');
        const csvInput = document.getElementById('csvInput');
        const importBtn = document.getElementById('importBtn');
        const fileInput = document.getElementById('fileInput');
        const importFileBtn = document.getElementById('importFileBtn');
        const clearStudentsBtn = document.getElementById('clearStudentsBtn');
        const studentList = document.getElementById('studentList');
        const totalStudentsEl = document.getElementById('totalStudents');
        const totalGroupsEl = document.getElementById('totalGroups');
        const fileInfo = document.getElementById('fileInfo');
        const feedbackBtn = document.getElementById('feedbackBtn');
        const languageSwitcher = document.getElementById('languageSwitcher');
        const themeSwitcher = document.getElementById('themeSwitcher');
        const eggButton = document.getElementById('eggButton');

        // åˆ‡æ¢å­¦ç”Ÿç®¡ç†ç•Œé¢æ˜¾ç¤º/éšè—
        function toggleStudentManagement(event) {
            const isHidden = studentManagementContainer.classList.contains('hidden');
            
            if (isHidden) {
                // æ˜¾ç¤ºå­¦ç”Ÿç®¡ç†åŒºåŸŸ
                studentManagementContainer.classList.remove('hidden');
                toggleStudentsBtn.textContent = currentLanguage === 'zh' ? 'éšè—å­¦ç”Ÿç®¡ç†' : 'Hide Student Management';
                
                // é‡æ–°æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨ä»¥ç¡®ä¿æ»šåŠ¨åŠŸèƒ½æ­£å¸¸
                renderStudentList();
            } else {
                // éšè—å­¦ç”Ÿç®¡ç†åŒºåŸŸ
                studentManagementContainer.classList.add('hidden');
                toggleStudentsBtn.textContent = currentLanguage === 'zh' ? 'ç®¡ç†å­¦ç”Ÿä¿¡æ¯' : 'Manage Students';
            }
            
            // é˜»æ­¢äº‹ä»¶å†’æ³¡
            if (event && event.stopPropagation) {
                event.stopPropagation();
            }
        }

        // ç®€åŒ–ç‰ˆè‡ªå®šä¹‰å¼¹çª—å‡½æ•°ï¼Œä½¿ç”¨ç³»ç»Ÿalertæ›¿ä»£
        function showCustomModal(title, message, callback) {
            // æ ¹æ®å½“å‰è¯­è¨€æ˜¾ç¤ºç›¸åº”çš„æ¶ˆæ¯
            const alertTitle = currentLanguage === 'zh' ? title : title;
            const alertMessage = currentLanguage === 'zh' ? message : message;
            
            alert(`${alertTitle}\n\n${alertMessage}`);
            if (callback && typeof callback === 'function') {
                callback();
            }
        }

        // æ·»åŠ å­¦ç”Ÿ
        function addStudent() {
            const id = studentId.value.trim();
            const name = studentName.value.trim();
            
            if (!name) {
                const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                const message = currentLanguage === 'zh' ? 'è¯·è¾“å…¥å­¦ç”Ÿå§“å' : 'Please enter student name';
                showCustomModal(title, message);
                return;
            }
            
            // ç¦ç”¨æ·»åŠ æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            addStudentBtn.disabled = true;
            addStudentBtn.textContent = currentLanguage === 'zh' ? 'æ·»åŠ ä¸­...' : 'Adding...';
            
            // ä½¿ç”¨StudentManageræ¥å¤„ç†å­¦ç”Ÿè¾“å…¥
            const student = { id, name };
            if (StudentManager.addStudent(student)) {
                renderStudentList();
                updateSummary();
                studentId.value = '';
                studentName.value = '';
                studentName.focus();
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                addStudentBtn.disabled = false;
                addStudentBtn.textContent = currentLanguage === 'zh' ? 'æ·»åŠ å­¦ç”Ÿ' : 'Add Student';
            } else {
                const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                const message = currentLanguage === 'zh' ? 'å­¦ç”Ÿå·²å­˜åœ¨ï¼ˆå­¦å·æˆ–å§“åé‡å¤ï¼‰' : 'Student already exists (duplicate ID or name)';
                showCustomModal(title, message);
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                addStudentBtn.disabled = false;
                addStudentBtn.textContent = currentLanguage === 'zh' ? 'æ·»åŠ å­¦ç”Ÿ' : 'Add Student';
            }
        }

        // æ‰¹é‡å¯¼å…¥å­¦ç”Ÿ
        function importStudents() {
            const csvText = csvInput.value.trim();
            if (csvText === '') {
                const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                const message = currentLanguage === 'zh' ? 'è¯·è¾“å…¥CSVæ•°æ®' : 'Please enter CSV data';
                showCustomModal(title, message);
                return;
            }
            
            // ç¦ç”¨å¯¼å…¥æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            importBtn.disabled = true;
            importBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥ä¸­...' : 'Importing...';
            
            try {
                const students = StudentManager.parseCSV(csvText);
                if (students.length === 0) {
                    const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                    const message = currentLanguage === 'zh' ? 'æœªè§£æåˆ°æœ‰æ•ˆå­¦ç”Ÿæ•°æ®' : 'No valid student data parsed';
                    showCustomModal(title, message);
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    importBtn.disabled = false;
                    importBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥CSV' : 'Import CSV';
                    return;
                }
                
                const addedCount = StudentManager.addStudents(students);
                renderStudentList();
                updateSummary();
                csvInput.value = '';
                const title = currentLanguage === 'zh' ? 'æˆåŠŸ' : 'Success';
                const message = currentLanguage === 'zh' ? 
                    `æˆåŠŸå¯¼å…¥ ${addedCount} åå­¦ç”Ÿ` : 
                    `Successfully imported ${addedCount} students`;
                showCustomModal(title, message);
            } catch (e) {
                const title = currentLanguage === 'zh' ? 'é”™è¯¯' : 'Error';
                const message = currentLanguage === 'zh' ? 
                    'å¯¼å…¥å¤±è´¥ï¼š' + e.message : 
                    'Import failed: ' + e.message;
                showCustomModal(title, message);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                importBtn.disabled = false;
                importBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥CSV' : 'Import CSV';
            }
        }

        // æ–‡ä»¶å¯¼å…¥å­¦ç”Ÿ
        function importFromFile() {
            const file = fileInput.files[0];
            if (!file) {
                const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                const message = currentLanguage === 'zh' ? 'è¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶' : 'Please select a file';
                showCustomModal(title, message);
                return;
            }
            
            // æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼Œåªå…è®¸CSVã€TXTå’ŒJSONæ ¼å¼
            if (!file.name.endsWith('.csv') && !file.name.endsWith('.txt') && !file.name.endsWith('.json')) {
                const title = currentLanguage === 'zh' ? 'é”™è¯¯' : 'Error';
                const message = currentLanguage === 'zh' ? 
                    'æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·ä½¿ç”¨CSVã€TXTæˆ–JSONæ ¼å¼çš„æ–‡ä»¶' : 
                    'File format not supported, please use CSV, TXT or JSON format files';
                showCustomModal(title, message);
                fileInput.value = ''; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                fileInfo.textContent = '';
                return;
            }
            
            // æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            const fileName = currentLanguage === 'zh' ? 'æ–‡ä»¶å' : 'File name';
            const fileSize = currentLanguage === 'zh' ? 'å¤§å°' : 'Size';
            const fileType = currentLanguage === 'zh' ? 'ç±»å‹' : 'Type';
            const unknown = currentLanguage === 'zh' ? 'æœªçŸ¥' : 'Unknown';
            
            fileInfo.textContent = `${fileName}: ${file.name} | ${fileSize}: ${(file.size / 1024).toFixed(1)} KB | ${fileType}: ${file.type || unknown}`;
            
            // ç¦ç”¨å¯¼å…¥æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            importFileBtn.disabled = true;
            importFileBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥ä¸­...' : 'Importing...';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    let students = [];
                    
                    // æ ¹æ®æ–‡ä»¶æ‰©å±•åå¤„ç†ä¸åŒæ ¼å¼
                    if (file.name.endsWith('.json')) {
                        // JSONæ ¼å¼
                        students = StudentManager.parseJSON(content);
                    } else {
                        // CSVå’ŒTXTæ ¼å¼
                        students = StudentManager.parseCSV(content);
                    }
                    
                    if (students.length === 0) {
                        const title = currentLanguage === 'zh' ? 'æç¤º' : 'Notice';
                        const message = currentLanguage === 'zh' ? 'æœªè§£æåˆ°æœ‰æ•ˆå­¦ç”Ÿæ•°æ®' : 'No valid student data parsed';
                        showCustomModal(title, message);
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        importFileBtn.disabled = false;
                        importFileBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥æ–‡ä»¶' : 'Import File';
                        return;
                    }
                    
                    const addedCount = StudentManager.addStudents(students);
                    renderStudentList();
                    updateSummary();
                    fileInput.value = '';
                    fileInfo.textContent = '';
                    const title = currentLanguage === 'zh' ? 'æˆåŠŸ' : 'Success';
                    const message = currentLanguage === 'zh' ? 
                        `æˆåŠŸå¯¼å…¥ ${addedCount} åå­¦ç”Ÿ` : 
                        `Successfully imported ${addedCount} students`;
                    showCustomModal(title, message);
                } catch (e) {
                    const title = currentLanguage === 'zh' ? 'é”™è¯¯' : 'Error';
                    const message = currentLanguage === 'zh' ? 
                        'å¯¼å…¥å¤±è´¥ï¼š' + e.message : 
                        'Import failed: ' + e.message;
                    showCustomModal(title, message);
                } finally {
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    importFileBtn.disabled = false;
                    importFileBtn.textContent = currentLanguage === 'zh' ? 'å¯¼å…¥æ–‡ä»¶' : 'Import File';
                }
            };
            
            // è¯»å–æ–‡ä»¶å†…å®¹
            reader.readAsText(file, 'UTF-8');
        }

        // HTMLè½¬ä¹‰å‡½æ•°ï¼Œé˜²æ­¢XSSæ”»å‡»
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"]/g, function(m) { return map[m]; });
        }

        // åˆ é™¤å­¦ç”Ÿ
        function removeStudent(index) {
            const title = currentLanguage === 'zh' ? 'ç¡®è®¤åˆ é™¤' : 'Confirm Delete';
            const message = currentLanguage === 'zh' ? 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­¦ç”Ÿå—ï¼Ÿ' : 'Are you sure you want to delete this student?';
            showCustomModal(title, message, function() {
                StudentManager.removeStudent(index);
                renderStudentList();
                updateSummary();
            });
        }

        // æ¸…ç©ºå­¦ç”Ÿåˆ—è¡¨
        function clearStudents() {
            const title = currentLanguage === 'zh' ? 'ç¡®è®¤æ¸…ç©º' : 'Confirm Clear';
            const message = currentLanguage === 'zh' ? 'ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å­¦ç”Ÿå—ï¼Ÿ' : 'Are you sure you want to clear all students?';
            showCustomModal(title, message, function() {
                StudentManager.clearStudents();
                renderStudentList();
                updateSummary();
            });
        }

        // ä¸ºè¯¾å ‚è¡¨ç°è®°å½•å™¨é€‰æ‹©å­¦ç”Ÿ
        function selectStudentForTracker(index) {
            const students = StudentManager.getStudents();
            if (index >= 0 && index < students.length) {
                const student = students[index];
                // ä¿å­˜é€‰ä¸­çš„å­¦ç”Ÿåˆ°localStorage
                try {
                    localStorage.setItem('classroom_tracker_current_student', JSON.stringify(student));
                    // è·³è½¬å›è¯¾å ‚è¡¨ç°è®°å½•å™¨
                    window.location.href = 'src/pages/classroom-tracker.html';
                } catch (e) {
                    console.error('ä¿å­˜å­¦ç”Ÿæ•°æ®å¤±è´¥:', e);
                    showCustomModal('é”™è¯¯', 'é€‰æ‹©å­¦ç”Ÿå¤±è´¥ï¼Œè¯·é‡è¯•');
                }
            }
        }

        // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
        function renderStudentList() {
            const students = StudentManager.getStudents();
            studentList.innerHTML = '';
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä»å…¶ä»–å·¥å…·è·³è½¬è¿‡æ¥çš„
            const urlParams = new URLSearchParams(window.location.search);
            const fromTracker = urlParams.get('from') === 'tracker';
            const fromRollCall = urlParams.get('from') === 'rollcall';
            const fromGrouping = urlParams.get('from') === 'grouping';
            const fromOtherTool = fromTracker || fromRollCall || fromGrouping;
            
            if (students.length === 0) {
                const noStudentsText = currentLanguage === 'zh' ? 'æš‚æ— å­¦ç”Ÿï¼Œè¯·æ·»åŠ å­¦ç”Ÿ' : 'No students, please add students';
                studentList.innerHTML = `<div class="empty-list">${noStudentsText}</div>`;
                return;
            }
            
            students.forEach((student, index) => {
                const studentItem = document.createElement('div');
                studentItem.className = 'student-item';
                
                // è½¬ä¹‰å­¦ç”Ÿä¿¡æ¯ä»¥é˜²æ­¢XSSæ”»å‡»
                const escapedId = student.id ? escapeHtml(student.id) : '';
                const escapedName = escapeHtml(student.name);
                
                // å¦‚æœæ˜¯ä»å…¶ä»–å·¥å…·è·³è½¬è¿‡æ¥çš„ï¼Œæ·»åŠ ç›¸åº”çš„æŒ‰é’®
                if (fromOtherTool) {
                    const studentInfo = student.id ? 
                        `<span class="student-info"><span class="student-id">${escapedId}</span> - ${escapedName}</span>` : 
                        `<span class="student-info">${escapedName}</span>`;
                    
                    // æ ¹æ®æ¥æºå·¥å…·æ˜¾ç¤ºä¸åŒçš„æŒ‰é’®
                    if (fromTracker) {
                        const selectText = currentLanguage === 'zh' ? 'é€‰æ‹©' : 'Select';
                        const deleteText = currentLanguage === 'zh' ? 'åˆ é™¤' : 'Delete';
                        
                        studentItem.innerHTML = `
                            ${studentInfo}
                            <button class="btn" onclick="selectStudentForTracker(${index})" style="padding: 0.5rem 1rem; font-size: 0.9rem;">${selectText}</button>
                            <button class="remove-student" onclick="removeStudent(${index})">${deleteText}</button>
                        `;
                    } else {
                        // å¯¹äºéšæœºç‚¹åå™¨å’Œå°ç»„åˆ†ç»„å™¨ï¼Œåªéœ€è¦æ˜¾ç¤ºå­¦ç”Ÿä¿¡æ¯å’Œåˆ é™¤æŒ‰é’®
                        const deleteText = currentLanguage === 'zh' ? 'åˆ é™¤' : 'Delete';
                        
                        studentItem.innerHTML = `
                            ${studentInfo}
                            <button class="remove-student" onclick="removeStudent(${index})">${deleteText}</button>
                        `;
                    }
                } else {
                    const studentInfo = student.id ? 
                        `<span class="student-info"><span class="student-id">${escapedId}</span> - ${escapedName}</span>` : 
                        `<span class="student-info">${escapedName}</span>`;
                    
                    const deleteText = currentLanguage === 'zh' ? 'åˆ é™¤' : 'Delete';
                    
                    studentItem.innerHTML = `
                        ${studentInfo}
                        <button class="remove-student" onclick="removeStudent(${index})">${deleteText}</button>
                    `;
                }
                
                studentList.appendChild(studentItem);
            });
        }

        // æ›´æ–°ç»Ÿè®¡æ‘˜è¦
        function updateSummary() {
            const students = StudentManager.getStudents();
            totalStudentsEl.textContent = students.length;
            
            // å»ºè®®åˆ†ç»„æ•°ï¼ˆæ¯ç»„4-6äººï¼‰
            const suggestedGroups = Math.max(1, Math.floor(students.length / 5));
            totalGroupsEl.textContent = suggestedGroups;
        }

        // æ˜¾ç¤ºé‚®ä»¶æç¤º
        function showEmailPrompt() {
            const email = 'crisweiming@hotmail.com';
            const message1 = currentLanguage === 'zh' ? 'è¯·å‘é€é‚®ä»¶è‡³ï¼š' : 'Please send email to: ';
            const message2 = currentLanguage === 'zh' ? 'æˆ‘ä»¬éå¸¸æœŸå¾…æ‚¨çš„å®è´µæ„è§ï¼' : 'We look forward to your valuable feedback!';
            
            alert(`${message1}${email}\n\n${message2}`);
            // æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // æèµ å¼¹çª—ç›¸å…³é…ç½®
        const donationConfig = {
            // éšæœºå¼¹å‡ºæ¦‚ç‡ (0-1ä¹‹é—´ï¼Œ0.15è¡¨ç¤º15%çš„æ¦‚ç‡)
            probability: 0.45,
            // æœ€å°é—´éš”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé¿å…é¢‘ç¹å¼¹å‡º
            minInterval: 1800000, // 30åˆ†é’Ÿ
            // æ¯æ¬¡ä¼šè¯æœ€å¤šå¼¹å‡ºæ¬¡æ•°
            maxShowPerSession: 3,
            // æ’é™¤çš„é¡µé¢ï¼ˆä¸è§¦å‘å¼¹çª—çš„ç›®æ ‡é¡µé¢ï¼‰
            excludePages: ['src/pages/donation.html']
        };
        
        // ä¼šè¯ä¸­å·²å¼¹å‡ºæ¬¡æ•°
        let donationShowCount = 0;
        
        // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºæèµ å¼¹çª—
        function shouldShowDonationModal(targetPage) {
            // å¦‚æœç›®æ ‡æ˜¯æèµ é¡µé¢ï¼Œä¸å¼¹çª—
            if (donationConfig.excludePages.some(page => targetPage.includes(page))) {
                return false;
            }
            
            // æ£€æŸ¥ä¼šè¯å¼¹å‡ºæ¬¡æ•°
            if (donationShowCount >= donationConfig.maxShowPerSession) {
                return false;
            }
            
            // æ£€æŸ¥ä¸Šæ¬¡å¼¹å‡ºæ—¶é—´
            const lastShowTime = localStorage.getItem('donationLastShowTime');
            if (lastShowTime) {
                const timeSinceLastShow = Date.now() - parseInt(lastShowTime);
                if (timeSinceLastShow < donationConfig.minInterval) {
                    return false;
                }
            }
            
            // éšæœºå†³å®šæ˜¯å¦å¼¹å‡º
            return Math.random() < donationConfig.probability;
        }
        
        // æ˜¾ç¤ºæèµ å¼¹çª—
        function showDonationModal(targetPage) {
            // ä¿å­˜ç›®æ ‡é¡µé¢ï¼Œä»¥ä¾¿ç”¨æˆ·å…³é—­å¼¹çª—åç»§ç»­å¯¼èˆª
            window.pendingNavigationPage = targetPage;
            
            // æ›´æ–°å¼¹çª—å†…å®¹ï¼ˆæ ¹æ®è¯­è¨€ï¼‰
            const modalTitle = document.getElementById('donationModalTitle');
            const modalMessage = document.getElementById('donationModalMessage');
            const modalBtn = document.getElementById('donationModalBtn');
            const modalLater = document.getElementById('donationModalLater');
            const modalTip = document.getElementById('donationModalTip');
            
            if (currentLanguage === 'zh') {
                modalTitle.textContent = 'å–œæ¬¢è¿™ä¸ªå·¥å…·å—ï¼Ÿ';
                modalMessage.textContent = 'å¦‚æœè¿™äº›å·¥å…·å¯¹æ‚¨çš„æ•™å­¦æœ‰å¸®åŠ©ï¼Œæ¬¢è¿æ‰“èµæ”¯æŒä½œè€…ç»§ç»­å¼€å‘æ›´å¤šå®ç”¨åŠŸèƒ½ï¼';
                modalBtn.textContent = 'å»æ”¯æŒä¸€ä¸‹';
                modalLater.textContent = 'ä¸‹æ¬¡å†è¯´';
                modalTip.textContent = 'ğŸ’¡ æ‚¨çš„æ”¯æŒæ˜¯ä½œè€…æŒç»­æ›´æ–°çš„åŠ¨åŠ›';
            } else {
                modalTitle.textContent = 'Like this tool?';
                modalMessage.textContent = 'If these tools help your teaching, please consider supporting the author to develop more useful features!';
                modalBtn.textContent = 'Support Now';
                modalLater.textContent = 'Maybe Later';
                modalTip.textContent = 'ğŸ’¡ Your support motivates the author to keep updating';
            }
            
            // æ˜¾ç¤ºå¼¹çª—
            const modal = document.getElementById('donationModal');
            modal.classList.add('show');
            
            // æ›´æ–°ç»Ÿè®¡
            donationShowCount++;
            localStorage.setItem('donationLastShowTime', Date.now().toString());
        }
        
        // å…³é—­æèµ å¼¹çª—
        function closeDonationModal() {
            const modal = document.getElementById('donationModal');
            modal.classList.remove('show');
            
            // ç»§ç»­å¯¼èˆªåˆ°åŸç›®æ ‡é¡µé¢
            if (window.pendingNavigationPage) {
                setTimeout(() => {
                    window.location.href = window.pendingNavigationPage;
                    window.pendingNavigationPage = null;
                }, 300);
            }
        }
        
        // å‰å¾€æèµ é¡µé¢
        function goToDonation() {
            const modal = document.getElementById('donationModal');
            modal.classList.remove('show');
            window.pendingNavigationPage = null;
            
            setTimeout(() => {
                window.location.href = 'src/pages/donation.html';
            }, 300);
        }
        
        // å¯¼èˆªåˆ°å…¶ä»–é¡µé¢
        function navigateTo(page) {
            // æ£€æŸ¥æ˜¯å¦æ˜¯ä»è¯¾å ‚è¡¨ç°è®°å½•å™¨ã€éšæœºç‚¹åå™¨æˆ–å°ç»„åˆ†ç»„å™¨è·³è½¬è¿‡æ¥çš„
            const urlParams = new URLSearchParams(window.location.search);
            const fromTracker = urlParams.get('from') === 'tracker';
            const fromRollCall = urlParams.get('from') === 'rollcall';
            const fromGrouping = urlParams.get('from') === 'grouping';
            
            if (fromTracker || fromRollCall || fromGrouping) {
                // å¦‚æœæ˜¯ä»å…¶ä»–å·¥å…·è·³è½¬è¿‡æ¥çš„ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
                let message = currentLanguage === 'zh' ?
                    'è¯·åœ¨ä¸‹æ–¹å­¦ç”Ÿåˆ—è¡¨ä¸­æ·»åŠ æˆ–é€‰æ‹©å­¦ç”Ÿ' :
                    'Please add or select students from the list below';
                    
                if (fromTracker) {
                    message = currentLanguage === 'zh' ?
                        'è¯·åœ¨ä¸‹æ–¹å­¦ç”Ÿåˆ—è¡¨ä¸­é€‰æ‹©è¦è®°å½•è¡¨ç°çš„å­¦ç”Ÿ' :
                        'Please select a student to track performance from the list below';
                } else if (fromRollCall) {
                    message = currentLanguage === 'zh' ?
                        'è¯·åœ¨ä¸‹æ–¹å­¦ç”Ÿåˆ—è¡¨ä¸­æ·»åŠ å­¦ç”Ÿï¼Œç„¶åè¿”å›éšæœºç‚¹åå™¨' :
                        'Please add students to the list below, then return to the roll call tool';
                } else if (fromGrouping) {
                    message = currentLanguage === 'zh' ?
                        'è¯·åœ¨ä¸‹æ–¹å­¦ç”Ÿåˆ—è¡¨ä¸­æ·»åŠ å­¦ç”Ÿï¼Œç„¶åè¿”å›å°ç»„åˆ†ç»„å™¨' :
                        'Please add students to the list below, then return to the group generator';
                }
                
                alert(message);
                // æ˜¾ç¤ºå­¦ç”Ÿç®¡ç†åŒºåŸŸ
                if (studentManagementContainer.classList.contains('hidden')) {
                    toggleStudentManagement();
                }
                return;
            }
            
            // éšæœºæ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºæèµ å¼¹çª—
            if (shouldShowDonationModal(page)) {
                showDonationModal(page);
                return;
            }
            
            window.location.href = page;
        }

        // è§¦å‘å½©è›‹ - å¸¦çƒŸèŠ±ç‰¹æ•ˆ
        function triggerEasterEgg() {
            const messages = {
                zh: [
                    "ğŸ‰ æ­å–œä½ å‘ç°äº†å½©è›‹ï¼",
                    "ğŸŒŸ ä½ çœŸæ˜¯ä¸€ä¸ªç»†å¿ƒçš„ç”¨æˆ·ï¼",
                    "ğŸ’– æ„Ÿè°¢ä½ å¯¹æ•™å¸ˆå·¥å…·ç®±çš„æ”¯æŒï¼",
                    "ğŸ“š å¸Œæœ›è¿™äº›å·¥å…·å¯¹ä½ çš„æ•™å­¦æœ‰å¸®åŠ©ï¼",
                    "ğŸŠ ç¥ä½ æ•™å­¦æ„‰å¿«ï¼Œå·¥ä½œé¡ºåˆ©ï¼"
                ],
                en: [
                    "ğŸ‰ Congratulations on finding the easter egg!",
                    "ğŸŒŸ You're really a careful user!",
                    "ğŸ’– Thank you for your support of the Teacher Toolkit!",
                    "ğŸ“š Hope these tools are helpful for your teaching!",
                    "ğŸŠ Wish you a happy teaching and smooth work!"
                ]
            };
            
            // è§¦å‘çƒŸèŠ±ç‰¹æ•ˆ
            launchFireworks();
            
            // å»¶è¿Ÿæ˜¾ç¤ºæ¶ˆæ¯ï¼Œè®©ç”¨æˆ·å…ˆæ¬£èµçƒŸèŠ±
            setTimeout(() => {
                const message = messages[currentLanguage][Math.floor(Math.random() * messages[currentLanguage].length)];
                alert(message);
            }, 1500);
        }
        
        // ==================== çƒŸèŠ±ç‰¹æ•ˆ ====================
        
        // çƒŸèŠ±ç²’å­ç±»
        class FireworkParticle {
            constructor(x, y, color, velocity, size, decay) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.velocity = velocity;
                this.size = size;
                this.decay = decay;
                this.alpha = 1;
                this.gravity = 0.05;
            }
            
            update() {
                this.velocity.x *= 0.99;
                this.velocity.y *= 0.99;
                this.velocity.y += this.gravity;
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= this.decay;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // çƒŸèŠ±ç±»
        class Firework {
            constructor(canvas, x, targetY) {
                this.canvas = canvas;
                this.x = x;
                this.y = canvas.height;
                this.targetY = targetY;
                this.speed = 8 + Math.random() * 4;
                this.exploded = false;
                this.particles = [];
                this.color = this.getRandomColor();
                this.trail = [];
            }
            
            getRandomColor() {
                const colors = [
                    '#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3',
                    '#F38181', '#AA96DA', '#FCBAD3', '#A8D8EA',
                    '#FF9F43', '#EE5A24', '#00D2D3', '#54A0FF',
                    '#5F27CD', '#FF6B81', '#FFC312', '#C4E538'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            update() {
                if (!this.exploded) {
                    // æ·»åŠ å°¾è¿¹
                    this.trail.push({ x: this.x, y: this.y, alpha: 1 });
                    if (this.trail.length > 10) {
                        this.trail.shift();
                    }
                    
                    // æ›´æ–°å°¾è¿¹é€æ˜åº¦
                    this.trail.forEach((point, index) => {
                        point.alpha = index / this.trail.length;
                    });
                    
                    this.y -= this.speed;
                    
                    if (this.y <= this.targetY) {
                        this.explode();
                    }
                } else {
                    // æ›´æ–°ç²’å­
                    this.particles = this.particles.filter(p => p.alpha > 0);
                    this.particles.forEach(p => p.update());
                }
            }
            
            explode() {
                this.exploded = true;
                const particleCount = 80 + Math.floor(Math.random() * 40);
                
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 / particleCount) * i;
                    const speed = 2 + Math.random() * 4;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };
                    
                    this.particles.push(new FireworkParticle(
                        this.x,
                        this.y,
                        this.color,
                        velocity,
                        2 + Math.random() * 2,
                        0.015 + Math.random() * 0.01
                    ));
                }
                
                // æ·»åŠ ä¸€äº›éšæœºæ–¹å‘çš„ç²’å­
                for (let i = 0; i < 20; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 1 + Math.random() * 3;
                    const velocity = {
                        x: Math.cos(angle) * speed,
                        y: Math.sin(angle) * speed
                    };
                    
                    this.particles.push(new FireworkParticle(
                        this.x,
                        this.y,
                        '#FFFFFF',
                        velocity,
                        1 + Math.random(),
                        0.02 + Math.random() * 0.01
                    ));
                }
            }
            
            draw(ctx) {
                if (!this.exploded) {
                    // ç»˜åˆ¶å°¾è¿¹
                    this.trail.forEach(point => {
                        ctx.save();
                        ctx.globalAlpha = point.alpha * 0.5;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(point.x, point.y, 2, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.restore();
                    });
                    
                    // ç»˜åˆ¶çƒŸèŠ±ä¸»ä½“
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // ç»˜åˆ¶ç²’å­
                    this.particles.forEach(p => p.draw(ctx));
                }
            }
            
            isDead() {
                return this.exploded && this.particles.length === 0;
            }
        }
        
        // å¯åŠ¨çƒŸèŠ±ç‰¹æ•ˆ
        function launchFireworks() {
            // åˆ›å»ºcanvas
            const canvas = document.createElement('canvas');
            canvas.id = 'fireworksCanvas';
            canvas.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 99999;
                pointer-events: none;
            `;
            document.body.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const fireworks = [];
            let animationId;
            let startTime = Date.now();
            const duration = 5000; // çƒŸèŠ±æŒç»­5ç§’
            
            // åˆ›å»ºåˆå§‹çƒŸèŠ±
            function createFirework() {
                const x = Math.random() * canvas.width;
                const targetY = 100 + Math.random() * (canvas.height * 0.4);
                fireworks.push(new Firework(canvas, x, targetY));
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animate() {
                const elapsed = Date.now() - startTime;
                
                // æ¸…é™¤ç”»å¸ƒï¼ˆå¸¦é€æ˜åº¦å®ç°æ‹–å°¾æ•ˆæœï¼‰
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // åœ¨å‰3ç§’å†…éšæœºåˆ›å»ºæ–°çƒŸèŠ±
                if (elapsed < 3000 && Math.random() < 0.1) {
                    createFirework();
                }
                
                // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
                fireworks.forEach(fw => {
                    fw.update();
                    fw.draw(ctx);
                });
                
                // ç§»é™¤å·²æ¶ˆå¤±çš„çƒŸèŠ±
                for (let i = fireworks.length - 1; i >= 0; i--) {
                    if (fireworks[i].isDead()) {
                        fireworks.splice(i, 1);
                    }
                }
                
                // æ£€æŸ¥æ˜¯å¦ç»“æŸ
                if (elapsed < duration || fireworks.length > 0) {
                    animationId = requestAnimationFrame(animate);
                } else {
                    // æ¸…ç†
                    cancelAnimationFrame(animationId);
                    canvas.remove();
                }
            }
            
            // åˆ›å»ºåˆå§‹çƒŸèŠ±å¹¶å¼€å§‹åŠ¨ç”»
            for (let i = 0; i < 5; i++) {
                setTimeout(() => createFirework(), i * 200);
            }
            
            animate();
        }

        // åˆ‡æ¢ä¸»é¢˜
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            
            // æ›´æ–°ä¸»é¢˜åˆ‡æ¢æŒ‰é’®æ–‡æœ¬
            if (document.body.classList.contains('dark-mode')) {
                themeSwitcher.textContent = currentLanguage === 'zh' ? 'æ—¥é—´æ¨¡å¼' : 'Light Mode';
            } else {
                themeSwitcher.textContent = currentLanguage === 'zh' ? 'é»‘å¤œæ¨¡å¼' : 'Dark Mode';
            }
            
            // ä¿å­˜ä¸»é¢˜è®¾ç½®åˆ°localStorage
            if (document.body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
            } else {
                localStorage.setItem('theme', 'light');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            // æ ¹æ®æµè§ˆå™¨è¯­è¨€è®¾ç½®é»˜è®¤è¯­è¨€
            const browserLanguage = navigator.language || navigator.userLanguage;
            currentLanguage = browserLanguage.startsWith('zh') ? 'zh' : 'en';
            
            // æ£€æŸ¥æ˜¯å¦ä¿å­˜äº†è¯­è¨€åå¥½
            const savedLanguage = localStorage.getItem('preferredLanguage');
            if (savedLanguage) {
                currentLanguage = savedLanguage;
            }
            
            // åº”ç”¨è¯­è¨€è®¾ç½®
            applyLanguage();
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æ•™å¸ˆèŠ‚
            checkTeachersDay();
            
            // æ£€æŸ¥å¹¶åŠ è½½å…¬å‘Š
            loadAnnouncement();
            
            // æ£€æŸ¥å¹¶åº”ç”¨ä¿å­˜çš„ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                if (themeSwitcher) {
                    themeSwitcher.textContent = currentLanguage === 'zh' ? 'æ—¥é—´æ¨¡å¼' : 'Light Mode';
                }
            }

            // æ£€æŸ¥æ˜¯å¦æ˜¾ç¤ºå½©è›‹æŒ‰é’®
            const eggClickCount = localStorage.getItem('eggClickCount') || 0;
            if (eggClickCount >= 5) {
                document.getElementById('eggButton').style.display = 'block';
            }
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners();
            
            // ç»‘å®šå½©è›‹è§¦å‘å…ƒç´ äº‹ä»¶
            const easterEggTrigger = document.getElementById('easterEggTrigger');
            if (easterEggTrigger) {
                let clickCount = 0;
                easterEggTrigger.addEventListener('click', function() {
                    clickCount++;
                    if (clickCount >= 5) {
                        // ä¿å­˜ç‚¹å‡»æ¬¡æ•°
                        localStorage.setItem('eggClickCount', clickCount);
                        // æ˜¾ç¤ºå½©è›‹æŒ‰é’®
                        document.getElementById('eggButton').style.display = 'block';
                        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                        const message = currentLanguage === 'zh' ? 
                            'æ­å–œä½ è§£é”äº†å½©è›‹åŠŸèƒ½ï¼ç‚¹å‡»é¡¶éƒ¨çš„"å½©è›‹"æŒ‰é’®æŸ¥çœ‹æƒŠå–œã€‚' : 
                            'Congratulations on unlocking the easter egg! Click the "Easter Egg" button at the top to see the surprise.';
                        alert(message);
                    }
                });
            }
        };
        
        // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            // è·å–DOMå…ƒç´ 
            const toggleStudentsBtn = document.getElementById('toggleStudentsBtn');
            const studentManagement = document.getElementById('studentManagement');
            const studentManagementContainer = studentManagement.parentElement;
            const studentId = document.getElementById('studentId');
            const studentName = document.getElementById('studentName');
            const addStudentBtn = document.getElementById('addStudentBtn');
            const csvInput = document.getElementById('csvInput');
            const importBtn = document.getElementById('importBtn');
            const fileInput = document.getElementById('fileInput');
            const importFileBtn = document.getElementById('importFileBtn');
            const clearStudentsBtn = document.getElementById('clearStudentsBtn');
            const studentList = document.getElementById('studentList');
            const totalStudentsEl = document.getElementById('totalStudents');
            const totalGroupsEl = document.getElementById('totalGroups');
            const fileInfo = document.getElementById('fileInfo');
            const feedbackBtn = document.getElementById('feedbackBtn');
            const languageSwitcher = document.getElementById('languageSwitcher');
            const themeSwitcher = document.getElementById('themeSwitcher');
            const eggButton = document.getElementById('eggButton');
            
            // ç»‘å®šè¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            if (languageSwitcher) {
                languageSwitcher.addEventListener('click', switchLanguage);
            }
            
            // ç»‘å®šä¸»é¢˜åˆ‡æ¢æŒ‰é’®äº‹ä»¶
            if (themeSwitcher) {
                themeSwitcher.addEventListener('click', toggleTheme);
            }
            
            // ç»‘å®šå­¦ç”Ÿç®¡ç†ç›¸å…³äº‹ä»¶ç›‘å¬å™¨
            if (toggleStudentsBtn) {
                toggleStudentsBtn.addEventListener('click', toggleStudentManagement);
            }
            
            if (addStudentBtn) {
                addStudentBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    addStudent();
                });
            }
            
            if (studentName) {
                studentName.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        addStudent();
                        e.stopPropagation();
                    }
                });
            }
            
            if (importBtn) {
                importBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    importStudents();
                });
            }
            
            if (importFileBtn) {
                importFileBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    importFromFile();
                });
            }
            
            if (clearStudentsBtn) {
                clearStudentsBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    clearStudents();
                });
            }
            
            if (feedbackBtn) {
                feedbackBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    showEmailPrompt();
                });
            }
            
            // æ–‡ä»¶é€‰æ‹©å˜åŒ–æ—¶æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        const file = this.files[0];
                        const fileName = currentLanguage === 'zh' ? 'æ–‡ä»¶å' : 'File name';
                        const fileSize = currentLanguage === 'zh' ? 'å¤§å°' : 'Size';
                        const fileType = currentLanguage === 'zh' ? 'ç±»å‹' : 'Type';
                        const unknown = currentLanguage === 'zh' ? 'æœªçŸ¥' : 'Unknown';
                        
                        fileInfo.textContent = `${fileName}: ${file.name} | ${fileSize}: ${(file.size / 1024).toFixed(1)} KB | ${fileType}: ${file.type || unknown}`;
                    } else {
                        fileInfo.textContent = '';
                    }
                });
            }
            
            // ç»‘å®šå®‰è£…æŒ‰é’®äº‹ä»¶
            const installPwaBtn = document.getElementById('installPwaBtn');
            if (installPwaBtn) {
                installPwaBtn.addEventListener('click', triggerPWAInstall);
            }
        }
        
        // æ£€æŸ¥PWAæ˜¯å¦å·²å®‰è£…
        function isPWAInstalled() {
            // æ£€æŸ¥localStorageæ ‡è®°
            if (localStorage.getItem('pwaInstalled') === 'true') {
                return true;
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨standaloneæ¨¡å¼ä¸‹è¿è¡Œ
            if (window.matchMedia('(display-mode: standalone)').matches) {
                localStorage.setItem('pwaInstalled', 'true');
                return true;
            }
            
            // æ£€æŸ¥navigator.standalone (iOS Safari)
            if (window.navigator.standalone === true) {
                localStorage.setItem('pwaInstalled', 'true');
                return true;
            }
            
            return false;
        }
        
        // è§¦å‘PWAå®‰è£…
        function triggerPWAInstall() {
            // å¦‚æœæœ‰å»¶è¿Ÿçš„å®‰è£…æç¤ºï¼Œåˆ™è§¦å‘å®ƒ
            if (deferredPrompt) {
                deferredPrompt.prompt();
                
                // ç­‰å¾…ç”¨æˆ·å“åº”
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ç”¨æˆ·æ¥å—äº†PWAå®‰è£…');
                        // éšè—å®‰è£…æŒ‰é’®
                        installPwaBtn.style.display = 'none';
                        // æ ‡è®°åº”ç”¨å·²å®‰è£…
                        localStorage.setItem('pwaInstalled', 'true');
                    } else {
                        console.log('ç”¨æˆ·æ‹’ç»äº†PWAå®‰è£…');
                        // ç”¨æˆ·æ‹’ç»åä»ç„¶æ˜¾ç¤ºæŒ‰é’®ï¼Œå…è®¸å†æ¬¡å°è¯•
                    }
                    deferredPrompt = null;
                });
            }
        }
        
        // ==================== å…¬å‘ŠåŠŸèƒ½ ====================
        
        // å…¬å‘Šç›¸å…³å˜é‡
        let currentAnnouncementContent = '';
        let currentAnnouncementHash = '';
        
        // ç®€å•çš„Markdownè§£æå™¨
        function parseMarkdown(markdown) {
            let html = markdown;
            
            // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦ï¼ˆä¿ç•™markdownè¯­æ³•ï¼‰
            html = html.replace(/&/g, '&amp;');
            html = html.replace(/</g, '&lt;');
            html = html.replace(/>/g, '&gt;');
            
            // æ ‡é¢˜
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');
            
            // ç²—ä½“å’Œæ–œä½“
            html = html.replace(/\*\*\*(.*?)\*\*\*/gim, '<strong><em>$1</em></strong>');
            html = html.replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>');
            html = html.replace(/\*(.*?)\*/gim, '<em>$1</em>');
            
            // æ— åºåˆ—è¡¨
            html = html.replace(/^\s*[-*+]\s+(.*$)/gim, '<li>$1</li>');
            html = html.replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>');
            
            // åˆ†éš”çº¿
            html = html.replace(/^---$/gim, '<hr>');
            
            // æ®µè½
            html = html.replace(/\n\n/g, '</p><p>');
            html = '<p>' + html + '</p>';
            
            // æ¸…ç†ç©ºæ®µè½
            html = html.replace(/<p>\s*<\/p>/g, '');
            html = html.replace(/<p>\s*<(h[1-3]|ul|hr)/g, '<$1');
            html = html.replace(/<\/(h[1-3]|ul|hr)>\s*<\/p>/g, '</$1>');
            
            // ä¿®å¤åˆ—è¡¨
            html = html.replace(/<\/li>\s*<li>/g, '</li><li>');
            html = html.replace(/<p><li>/g, '<ul><li>');
            html = html.replace(/<\/li><\/p>/g, '</li></ul>');
            
            return html;
        }
        
        // ç”Ÿæˆå†…å®¹å“ˆå¸Œï¼ˆç”¨äºæ£€æµ‹å…¬å‘Šæ˜¯å¦æ›´æ–°ï¼‰
        function generateHash(content) {
            let hash = 0;
            for (let i = 0; i < content.length; i++) {
                const char = content.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return hash.toString();
        }
        
        // åŠ è½½å…¬å‘Š
        async function loadAnnouncement() {
            // æ£€æŸ¥æ˜¯å¦åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è¿è¡Œ
            if (window.location.protocol === 'file:') {
                console.log('å…¬å‘ŠåŠŸèƒ½åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ(file://)ä¸‹ä¸å¯ç”¨ï¼Œè¯·ä½¿ç”¨HTTPæœåŠ¡å™¨');
                return;
            }
            
            try {
                // å°è¯•è·å–GONGGAO.mdæ–‡ä»¶
                const response = await fetch('GONGGAO.md?t=' + Date.now());
                
                if (!response.ok) {
                    console.log('æ²¡æœ‰æ‰¾åˆ°å…¬å‘Šæ–‡ä»¶');
                    return;
                }
                
                const content = await response.text();
                
                if (!content || content.trim() === '') {
                    console.log('å…¬å‘Šå†…å®¹ä¸ºç©º');
                    return;
                }
                
                // ä¿å­˜å…¬å‘Šå†…å®¹
                currentAnnouncementContent = content;
                currentAnnouncementHash = generateHash(content);
                
                // æ˜¾ç¤ºå…¬å‘Šä¸­å¿ƒæŒ‰é’®
                const announcementCenterBtn = document.getElementById('announcementCenterBtn');
                if (announcementCenterBtn) {
                    announcementCenterBtn.style.display = 'flex';
                }
                
                // æ£€æŸ¥æ˜¯å¦æ°¸ä¹…å…³é—­äº†æ­¤å…¬å‘Š
                const permanentlyClosedHash = localStorage.getItem('announcementPermanentlyClosed');
                if (permanentlyClosedHash === currentAnnouncementHash) {
                    // ç”¨æˆ·å·²æ°¸ä¹…å…³é—­æ­¤å…¬å‘Šï¼Œä¸è‡ªåŠ¨å¼¹å‡ºï¼Œä½†ä»æ˜¾ç¤ºå…¬å‘Šä¸­å¿ƒæŒ‰é’®
                    updateAnnouncementBadge(false);
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦åœ¨æœ¬æ¬¡ä¼šè¯ä¸­å·²å…³é—­
                const sessionClosedHash = sessionStorage.getItem('announcementSessionClosed');
                if (sessionClosedHash === currentAnnouncementHash) {
                    // æœ¬æ¬¡ä¼šè¯å·²å…³é—­ï¼Œä¸è‡ªåŠ¨å¼¹å‡º
                    updateAnnouncementBadge(false);
                    return;
                }
                
                // æ˜¾ç¤ºæœªè¯»æ ‡è®°
                updateAnnouncementBadge(true);
                
                // è‡ªåŠ¨å¼¹å‡ºå…¬å‘Š
                showAnnouncementModal();
                
            } catch (error) {
                console.log('åŠ è½½å…¬å‘Šå¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°å…¬å‘Šæœªè¯»æ ‡è®°
        function updateAnnouncementBadge(hasUnread) {
            const badge = document.getElementById('announcementBadge');
            if (badge) {
                if (hasUnread) {
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }
        
        // æ˜¾ç¤ºå…¬å‘Šå¼¹çª—
        function showAnnouncementModal() {
            if (!currentAnnouncementContent) {
                return;
            }
            
            // æ›´æ–°å¼¹çª—æ ‡é¢˜ï¼ˆæ ¹æ®è¯­è¨€ï¼‰
            const modalTitle = document.getElementById('announcementModalTitle');
            const closeBtn = document.getElementById('announcementCloseBtn');
            const permanentBtn = document.getElementById('announcementPermanentBtn');
            
            if (currentLanguage === 'zh') {
                modalTitle.textContent = 'ğŸ“¢ å…¬å‘Š';
                closeBtn.textContent = 'æˆ‘çŸ¥é“äº†';
                permanentBtn.textContent = 'ä¸å†æ˜¾ç¤ºæ­¤å…¬å‘Š';
            } else {
                modalTitle.textContent = 'ğŸ“¢ Announcement';
                closeBtn.textContent = 'Got it';
                permanentBtn.textContent = 'Don\'t show again';
            }
            
            // è§£æå¹¶æ˜¾ç¤ºå…¬å‘Šå†…å®¹
            const contentEl = document.getElementById('announcementModalContent');
            contentEl.innerHTML = parseMarkdown(currentAnnouncementContent);
            
            // æ˜¾ç¤ºå¼¹çª—
            const modal = document.getElementById('announcementModal');
            modal.classList.add('show');
        }
        
        // å…³é—­å…¬å‘Šå¼¹çª—ï¼ˆæœ¬æ¬¡ä¼šè¯ä¸å†æ˜¾ç¤ºï¼‰
        function closeAnnouncementModal() {
            const modal = document.getElementById('announcementModal');
            modal.classList.remove('show');
            
            // æ ‡è®°æœ¬æ¬¡ä¼šè¯å·²å…³é—­
            sessionStorage.setItem('announcementSessionClosed', currentAnnouncementHash);
            
            // ç§»é™¤æœªè¯»æ ‡è®°
            updateAnnouncementBadge(false);
        }
        
        // æ°¸ä¹…å…³é—­å…¬å‘Šï¼ˆç›´åˆ°å…¬å‘Šå†…å®¹æ›´æ–°ï¼‰
        function permanentlyCloseAnnouncement() {
            const modal = document.getElementById('announcementModal');
            modal.classList.remove('show');
            
            // æ°¸ä¹…æ ‡è®°æ­¤å…¬å‘Šå·²å…³é—­
            localStorage.setItem('announcementPermanentlyClosed', currentAnnouncementHash);
            
            // ç§»é™¤æœªè¯»æ ‡è®°
            updateAnnouncementBadge(false);
        }
        
        // æ‰“å¼€å…¬å‘Šä¸­å¿ƒï¼ˆä»å³ä¸Šè§’æŒ‰é’®ç‚¹å‡»ï¼‰
        function openAnnouncementCenter() {
            if (currentAnnouncementContent) {
                showAnnouncementModal();
            } else {
                // å¦‚æœæ²¡æœ‰å…¬å‘Šå†…å®¹ï¼Œå°è¯•é‡æ–°åŠ è½½
                loadAnnouncement().then(() => {
                    if (currentAnnouncementContent) {
                        showAnnouncementModal();
                    } else {
                        const message = currentLanguage === 'zh' ? 'æš‚æ— å…¬å‘Š' : 'No announcements';
                        alert(message);
                    }
                });
            }
        }
    </script>
</body>
</html>
